{{template "base" .}}

{{define "content"}}
<div class="container">
  <div class="row "> <!-- alternative image centering: add justify-content-center class here -->
    <!-- <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"> -->
    <div class="col">
      <img src="/static/images/generals-quarters.png" class="img-thumbnail img-fluid mx-auto d-block room-image"
        alt="room image">
    </div>
  </div>
  <div class="row">
    <div class="col">
      <h1 class="text-center mt-4">General's Quarters</h1>
      <p>
        Your home away from home, set on the majestic waters of the Atlantic Ocean,
        this will be the vacation to remember.
        Your home away from home, set on the majestic waters of the Atlantic Ocean,
        this will be the vacation to remember.
        Your home away from home, set on the majestic waters of the Atlantic Ocean,
        this will be the vacation to remember.
        Your home away from home, set on the majestic waters of the Atlantic Ocean,
        this will be the vacation to remember.
        Your home away from home, set on the majestic waters of the Atlantic Ocean,
        this will be the vacation to remember.

      </p>
    </div>

  </div>
  <div class="row">
    <div class="col text-center">
      <a id="check-availability-button" href="#!" class="btn btn-success">Check Availability</a>
    </div>
  </div>
</div>
{{end}}

{{define "js"}}
<script>
  document.getElementById('check-availability-button').addEventListener("click", function () {
    let html = /*html*/`
          <form id="check-availability-form" action="" method="post" novalidate class="needs-validation">
              <div class="form-row">
                <div class="col">
                  <div class="form-row" id="reservation-dates-modal">
                    <div class="col">
                      <input disabled required class="form-control" type="text" name="start" id="start" placeholder="Arrival">
                    </div>
                    <div class="col">
                      <input disabled required class="form-control" type="text" name="end" id="end" placeholder="Departure">
                    </div>
                  </div>
                </div>
              </div>
          </form>
          `;
    attention.custom({
      msg: html,
      title: "Choose your dates",
      // cut from base.layout, it will be sent as param - thus we make layout sweetalert call independent
      willOpen: () => {
        // we want to display pop-up calendar
        const elem = document.getElementById('reservation-dates-modal');
        const rp = new DateRangePicker(elem, {
          format: 'yyyy-mm-dd',
          showOnFocus: true,
          minDate: new Date(),
        })
      },
      didOpen: () => {
        // we have to remove disabled properties
        // disabled were introduced so that the inputs don't have focus
        document.getElementById("start").removeAttribute("disabled");
        document.getElementById("end").removeAttribute("disabled");
      },
      callback: function (result) {
        console.log("called")

        const form = document.getElementById("check-availability-form");
        const formData = new FormData(form); // create form data of this form
        // we have to add the csrf_token here because it's not in the above form (we could add it there but there's another way)
        formData.append("csrf_token", "{{.CSRFToken}}");
        formData.append("room_id", "1");

        // perform JSON request with POST (we change the method in routes as well)
        fetch('/search-availability-json', {
          method: "post",
          body: formData,
        })
          .then(response => response.json())
          .then(data => {
            if (data.ok) {
              const href = `/book-room?id=${data.room_id}&s=${data.start_date}&e=${data.end_date}`
              attention.custom({
                icon: 'success',
                showConfirmButton: false,
                msg: /*html*/`<p>Room is available</p>
                      <p><a href="${href}" class="btn btn-primary">Book now!</a></p>`
              })
            } else {
              attention.error({
                msg: "No availability",
              });
            }
          });
      }
    });
  });
</script>
{{end}}